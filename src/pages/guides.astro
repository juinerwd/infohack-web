---
import BaseLayout from '../layouts/BaseLayout.astro';
import FloatingAudioPlayer from '../components/FloatingAudioPlayer.astro';
import Header from '../sections/Header.astro';
import Card from '../components/Card.astro';
import { getCollection } from 'astro:content';

const currentPath = Astro.url.pathname;

const guides = await getCollection('guides');
const sortedGuides = guides.sort((a, b) => 
  new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime()
);

const featuredGuides = sortedGuides.filter(guide => guide.data.featured);
const regularGuides = sortedGuides.filter(guide => !guide.data.featured);
---

<BaseLayout 
  title="Protege tus Datos - GuÃ­as de Seguridad Personal" 
  description="GuÃ­as prÃ¡cticas para proteger tu informaciÃ³n personal, configurar herramientas de seguridad y navegar de forma segura en internet."
>
  <Header currentPath={currentPath} />
  <main class="min-h-screen bg-gradient-to-b from-slate-50 to-slate-100 py-12">
    <div class="container mx-auto px-4 max-w-7xl">
      <!-- Encabezado -->
      <div class="text-center mb-16">
        <h1 class="text-4xl md:text-5xl font-bold text-slate-800 mb-6">
          ğŸ›¡ï¸ Protege tus Datos
        </h1>
        <p class="text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed mb-8">
          GuÃ­as prÃ¡cticas y paso a paso para usuarios comunes. Aprende a proteger tu informaciÃ³n personal, 
          configurar herramientas de seguridad y navegar de forma segura en el mundo digital.
        </p>
        <div class="flex flex-wrap justify-center gap-3 text-sm text-slate-500">
          <span class="bg-white px-4 py-2 rounded-full border shadow-sm">âœ… Sin jerga tÃ©cnica</span>
          <span class="bg-white px-4 py-2 rounded-full border shadow-sm">âš¡ AplicaciÃ³n inmediata</span>
          <span class="bg-white px-4 py-2 rounded-full border shadow-sm">ğŸ”’ Uso Ã©tico solamente</span>
        </div>
      </div>

      <!-- GuÃ­as destacadas -->
      {featuredGuides.length > 0 && (
        <section class="mb-20">
          <h2 class="text-3xl font-bold text-slate-800 mb-10 flex items-center">
            <span class="text-yellow-500 mr-3">â­</span>
            GuÃ­as Destacadas
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {featuredGuides.map((guide) => (
              <Card
                title={guide.data.title}
                description={guide.data.description}
                href={`/guides/${guide.slug}/`}
                tags={guide.data.tags}
                level={guide.data.level}
                estimatedTime={guide.data.estimatedTime}
                publishDate={guide.data.publishDate}
                category={guide.data.category}
              />
            ))}
          </div>
        </section>
      )}

      <!-- Todas las guÃ­as -->
      <section class="mb-20">
        <h2 class="text-3xl font-bold text-slate-800 mb-10 flex items-center">
          <span class="text-blue-500 mr-3">ğŸ“š</span>
          Todas las GuÃ­as
          <span class="ml-3 text-lg font-normal text-slate-500">
            ({sortedGuides.length} disponibles)
          </span>
        </h2>
        
        {sortedGuides.length === 0 ? (
          <div class="text-center py-20 bg-white rounded-xl shadow-sm border">
            <div class="text-7xl mb-6">ğŸ“‹</div>
            <h3 class="text-2xl font-semibold text-slate-700 mb-4">
              PrÃ³ximamente mÃ¡s guÃ­as
            </h3>
            <p class="text-slate-500 max-w-md mx-auto text-lg">
              Estamos preparando contenido educativo de alta calidad. 
              Vuelve pronto para encontrar guÃ­as detalladas sobre protecciÃ³n de datos.
            </p>
          </div>
        ) : (
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {sortedGuides.map((guide) => (
              <Card
                title={guide.data.title}
                description={guide.data.description}
                href={`/guides/${guide.slug}/`}
                tags={guide.data.tags}
                level={guide.data.level}
                estimatedTime={guide.data.estimatedTime}
                publishDate={guide.data.publishDate}
                category={guide.data.category}
              />
            ))}
          </div>
        )}
      </section>

      <!-- CategorÃ­as -->
      <section class="mb-20">
        <h2 class="text-3xl font-bold text-slate-800 mb-10">
          ğŸ“‚ Explorar por CategorÃ­a
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          <!-- ProtecciÃ³n -->
          <div class="bg-white p-8 rounded-xl shadow-sm border hover:shadow-lg transition-all duration-300">
            <div class="text-4xl mb-4">ğŸ›¡ï¸</div>
            <h3 class="text-xl font-semibold text-slate-800 mb-3">ProtecciÃ³n Personal</h3>
            <p class="text-slate-600 mb-4 leading-relaxed">
              ContraseÃ±as seguras, autenticaciÃ³n en dos factores, gestores de contraseÃ±as.
            </p>
            <div class="text-sm text-slate-500 font-medium">
              {guides.filter(g => g.data.category === 'proteccion').length} guÃ­as disponibles
            </div>
          </div>

          <!-- NavegaciÃ³n -->
          <div class="bg-white p-8 rounded-xl shadow-sm border hover:shadow-lg transition-all duration-300">
            <div class="text-4xl mb-4">ğŸŒ</div>
            <h3 class="text-xl font-semibold text-slate-800 mb-3">NavegaciÃ³n Segura</h3>
            <p class="text-slate-600 mb-4 leading-relaxed">
              WiFi pÃºblico, detecciÃ³n de phishing, configuraciones de privacidad.
            </p>
            <div class="text-sm text-slate-500 font-medium">
              {guides.filter(g => g.data.category === 'navegacion').length} guÃ­as disponibles
            </div>
          </div>

          <!-- Privacidad -->
          <div class="bg-white p-8 rounded-xl shadow-sm border hover:shadow-lg transition-all duration-300">
            <div class="text-4xl mb-4">ğŸ”’</div>
            <h3 class="text-xl font-semibold text-slate-800 mb-3">Privacidad Digital</h3>
            <p class="text-slate-600 mb-4 leading-relaxed">
              Redes sociales, datos personales, configuraciones de aplicaciones.
            </p>
            <div class="text-sm text-slate-500 font-medium">
              {guides.filter(g => g.data.category === 'privacidad').length} guÃ­as disponibles
            </div>
          </div>
        </div>
      </section>

      <!-- Llamada a la acciÃ³n -->
      <section class="bg-gradient-to-r from-green-50 to-green-100 p-12 rounded-xl border border-green-200">
        <div class="text-center">
          <h2 class="text-3xl font-bold text-green-800 mb-6">
            Â¿Necesitas ayuda especÃ­fica?
          </h2>
          <p class="text-green-700 mb-8 max-w-2xl mx-auto text-lg leading-relaxed">
            Si no encuentras lo que buscas o tienes dudas especÃ­ficas, 
            recuerda que la seguridad es un proceso continuo de aprendizaje.
          </p>
          <div class="flex flex-col sm:flex-row gap-6 justify-center">
            <a 
              href="/tutorials" 
              class="bg-green-600 text-white px-8 py-4 rounded-lg hover:bg-green-700 transition-colors font-medium text-lg shadow-md hover:shadow-lg"
            >
              Ver Tutoriales TÃ©cnicos
            </a>
            <a 
              href="/news" 
              class="border-2 border-green-600 text-green-600 px-8 py-4 rounded-lg hover:bg-green-50 transition-colors font-medium text-lg shadow-md hover:shadow-lg"
            >
              Noticias de Seguridad
            </a>
          </div>
        </div>
      </section>
    </div>
  </main>
  
  <!-- Floating Audio Player -->
  <FloatingAudioPlayer 
    audioSrc="/por-que-es-importante-proteger-nuestros-datos.m4a"
    title="Â¿Por quÃ© proteger tus datos?"
    autoplay={true}
    position="bottom-right"
  />
</BaseLayout>
