---
// PasswordGenerator.astro
---

<div class="password-generator-container">
  <div class="generator-card">
    <div class="header-section">
      <h3 class="generator-title">游댏 Generador de Contrase침as</h3>
      <p class="generator-description">
        Crea contrase침as seguras y personalizadas para proteger tus cuentas.
      </p>
    </div>

    <div class="password-section">
      <label class="section-label">Contrase침a generada</label>
      <div class="password-display">
        <input
          type="text"
          id="password-output"
          readonly
          class="password-input"
          placeholder="Haz clic en 'Generar' para crear una contrase침a"
        />
        <button id="copy-btn" class="copy-button" title="Copiar contrase침a">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
            ></path>
          </svg>
        </button>
        <button id="generate-btn" class="generate-button"> 游댃 Generar </button>
      </div>

      <div class="strength-section">
        <div class="strength-header">
          <span class="strength-label">Fuerza de la contrase침a</span>
          <span id="strength-text" class="strength-value">-</span>
        </div>
        <div class="strength-bar">
          <div id="strength-fill" class="strength-fill"></div>
        </div>
      </div>
    </div>

    <div class="options-grid">
      <!-- Selector de tipo -->
      <div class="type-section">
        <h4 class="option-title">游꿢 Tipo de contrase침a</h4>
        <div class="type-buttons">
          <button id="type-password" class="type-button active"
            >游댟 Contrase침a</button
          >
          <button id="type-passphrase" class="type-button">游닇 Frase</button>
        </div>
      </div>

      <div class="length-section">
        <h4 class="option-title">游늺 Longitud</h4>
        <div class="length-control">
          <div class="length-header">
            <label class="length-label">Caracteres</label>
            <span id="length-value" class="length-value">16</span>
          </div>
          <input
            type="range"
            id="length"
            min="8"
            max="128"
            value="16"
            class="length-slider"
          />
          <div class="length-markers">
            <span>8</span>
            <span>128</span>
          </div>
        </div>
      </div>

      <div class="character-section">
        <h4 class="option-title">游댟 Caracteres a incluir</h4>
        <div
          id="character-options"
          class="character-options grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="character-option">
            <input
              type="checkbox"
              id="uppercase"
              checked
              class="option-checkbox"
            />
            <div class="option-content">
              <span class="option-text">May칰sculas (A-Z)</span>
              <span class="option-example">ABCDEFGH...</span>
            </div>
          </label>

          <label class="character-option">
            <input
              type="checkbox"
              id="lowercase"
              checked
              class="option-checkbox"
            />
            <div class="option-content">
              <span class="option-text">Min칰sculas (a-z)</span>
              <span class="option-example">abcdefgh...</span>
            </div>
          </label>

          <label class="character-option">
            <input
              type="checkbox"
              id="numbers"
              checked
              class="option-checkbox"
            />
            <div class="option-content">
              <span class="option-text">N칰meros (0-9)</span>
              <span class="option-example">0123456789</span>
            </div>
          </label>

          <label class="character-option">
            <input
              type="checkbox"
              id="symbols"
              checked
              class="option-checkbox"
            />
            <div class="option-content">
              <span class="option-text">S칤mbolos</span>
              <span class="option-example">!@#$%^&*...</span>
            </div>
          </label>
        </div>

        <!-- Opciones para frases (ocultas por defecto) -->
        <div
          id="passphrase-options"
          class="passphrase-options"
          style="display: none;"
        >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="character-option">
              <input
                type="checkbox"
                id="include-numbers-phrase"
                class="option-checkbox"
              />
              <div class="option-content">
                <span class="option-text">Incluir n칰meros</span>
                <span class="option-example">casa2-perro7-azul3</span>
              </div>
            </label>

            <label class="character-option">
              <input
                type="checkbox"
                id="capitalize-words"
                checked
                class="option-checkbox"
              />
              <div class="option-content">
                <span class="option-text">Capitalizar palabras</span>
                <span class="option-example">Casa-Perro-Azul</span>
              </div>
            </label>
          </div>

          <div class="separator-section">
            <label class="section-label">Separador</label>
            <select id="word-separator" class="separator-select">
              <option value="-">Gui칩n (-)</option>
              <option value="_">Gui칩n bajo (_)</option>
              <option value=".">Punto (.)</option>
              <option value=" ">Espacio</option>
              <option value="">Sin separador</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div id="notification" class="notification">춰Contrase침a copiada!</div>
  </div>
</div>

<style>
  .password-generator-container {
    max-width: 100%;
    margin: 0 auto;
  }

  .generator-card {
    background: transparent;
    padding: 24px;
    transition: all 0.2s ease-in-out;
  }

  .header-section {
    text-align: center;
    margin-bottom: 24px;
  }

  .generator-title {
    font-size: 24px;
    font-weight: 700;
    color: #1f2937;
    margin: 0 0 8px 0;
  }

  .generator-description {
    color: #6b7280;
    margin: 0;
    font-size: 14px;
  }

  .password-section {
    margin-bottom: 24px;
  }

  .section-label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
  }

  .password-display {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }

  .password-input {
    flex: 1;
    min-width: 200px;
    padding: 12px 16px;
    font-size: 14px;
    font-family: "SF Mono", "Monaco", "Inconsolata", "Roboto Mono", monospace;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    background: #f9fafb;
    color: #1f2937;
    transition: all 0.2s;
  }

  .password-input:focus {
    outline: none;
    border-color: #3b82f6;
    ring: 2px solid rgba(59, 130, 246, 0.1);
  }

  .copy-button {
    padding: 12px;
    background: #10b981;
    border: none;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .copy-button:hover {
    background: #059669;
    transform: translateY(-1px);
  }

  .generate-button {
    padding: 12px 20px;
    background: #3b82f6;
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .generate-button:hover {
    background: #2563eb;
    transform: translateY(-1px);
  }

  .strength-section {
    margin-top: 16px;
  }

  .strength-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
  }

  .strength-label {
    font-size: 12px;
    color: #6b7280;
  }

  .strength-value {
    font-size: 12px;
    font-weight: 600;
    color: #374151;
  }

  .strength-bar {
    height: 6px;
    background: #e5e7eb;
    border-radius: 3px;
    overflow: hidden;
  }

  .strength-fill {
    height: 100%;
    width: 0%;
    transition: all 0.3s ease;
    border-radius: 3px;
  }

  .options-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
    margin-bottom: 24px;
  }

  @media (min-width: 768px) {
    .options-grid {
      grid-template-columns: 1fr 1fr;
    }

    .password-display {
      flex-wrap: nowrap;
    }
  }

  .option-title {
    font-size: 16px;
    font-weight: 600;
    color: #1f2937;
    margin: 0 0 16px 0;
  }

  .length-section {
    space-y: 16px;
  }

  .length-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .length-label {
    font-size: 14px;
    color: #6b7280;
  }

  .length-value {
    font-size: 14px;
    font-weight: 600;
    color: #1f2937;
    background: #f3f4f6;
    padding: 4px 8px;
    border-radius: 4px;
    font-family: monospace;
  }

  .length-slider {
    width: 100%;
    height: 6px;
    background: #e5e7eb;
    border-radius: 3px;
    outline: none;
    cursor: pointer;
    -webkit-appearance: none;
  }

  .length-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }

  .length-slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }

  .length-markers {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    font-size: 12px;
    color: #9ca3af;
  }

  .character-options {
    space-y: 12px;
  }

  .character-option {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    cursor: pointer;
    padding: 8px 0;
  }

  .option-checkbox {
    width: 16px;
    height: 16px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 2px;
    flex-shrink: 0;
  }

  .option-checkbox:checked {
    background: #3b82f6;
    border-color: #3b82f6;
  }

  .option-content {
    flex: 1;
  }

  .option-text {
    display: block;
    font-size: 14px;
    color: #374151;
    font-weight: 500;
  }

  .option-example {
    display: block;
    font-size: 12px;
    color: #9ca3af;
    font-family: monospace;
    margin-top: 2px;
  }

  .type-section {
    grid-column: 1 / -1;
    margin-bottom: 8px;
  }

  .type-buttons {
    display: flex;
    gap: 8px;
  }

  .type-button {
    flex: 1;
    padding: 10px 16px;
    border: 1px solid #d1d5db;
    background: #f9fafb;
    color: #6b7280;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
  }

  .type-button.active {
    background: #3b82f6;
    color: white;
    border-color: #3b82f6;
  }

  .type-button:hover:not(.active) {
    background: #e5e7eb;
  }

  .separator-section {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #e5e7eb;
  }

  .separator-select {
    width: 100%;
    padding: 6px 10px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    background: white;
    font-size: 13px;
    margin-top: 6px;
  }

  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    opacity: 0;
    transform: translateX(100px);
    transition: all 0.3s ease;
    pointer-events: none;
    z-index: 1000;
  }

  .notification.show {
    opacity: 1;
    transform: translateX(0);
  }
</style>

<script>
  const passwordOutput = document.getElementById(
    "password-output",
  ) as HTMLInputElement;
  const lengthSlider = document.getElementById("length") as HTMLInputElement;
  const lengthValue = document.getElementById(
    "length-value",
  ) as HTMLSpanElement;
  const uppercaseCheck = document.getElementById(
    "uppercase",
  ) as HTMLInputElement;
  const lowercaseCheck = document.getElementById(
    "lowercase",
  ) as HTMLInputElement;
  const numbersCheck = document.getElementById("numbers") as HTMLInputElement;
  const symbolsCheck = document.getElementById("symbols") as HTMLInputElement;
  const generateBtn = document.getElementById(
    "generate-btn",
  ) as HTMLButtonElement;
  const copyBtn = document.getElementById("copy-btn") as HTMLButtonElement;
  const strengthFill = document.getElementById(
    "strength-fill",
  ) as HTMLDivElement;
  const strengthText = document.getElementById(
    "strength-text",
  ) as HTMLParagraphElement;
  const notification = document.getElementById(
    "notification",
  ) as HTMLDivElement;

  // Elementos para frases
  const typePasswordBtn = document.getElementById(
    "type-password",
  ) as HTMLButtonElement;
  const typePassphraseBtn = document.getElementById(
    "type-passphrase",
  ) as HTMLButtonElement;
  const characterOptions = document.getElementById(
    "character-options",
  ) as HTMLElement;
  const passphraseOptions = document.getElementById(
    "passphrase-options",
  ) as HTMLElement;
  const includeNumbersPhrase = document.getElementById(
    "include-numbers-phrase",
  ) as HTMLInputElement;
  const capitalizeWords = document.getElementById(
    "capitalize-words",
  ) as HTMLInputElement;
  const wordSeparator = document.getElementById(
    "word-separator",
  ) as HTMLSelectElement;

  const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const lowercase = "abcdefghijklmnopqrstuvwxyz";
  const numbers = "0123456789";
  const symbols = "!@#$%^&*()_+-=[]{}|;:,.<>?";

  // Palabras para frases
  const spanishWords = [
    "casa",
    "perro",
    "gato",
    "agua",
    "fuego",
    "tierra",
    "aire",
    "sol",
    "luna",
    "estrella",
    "azul",
    "verde",
    "rojo",
    "amarillo",
    "negro",
    "blanco",
    "naranja",
    "morado",
    "rosa",
    "mar",
    "monta침a",
    "rio",
    "bosque",
    "campo",
    "ciudad",
    "pueblo",
    "calle",
    "plaza",
    "parque",
    "libro",
    "mesa",
    "silla",
    "puerta",
    "ventana",
    "cocina",
    "ba침o",
    "techo",
    "suelo",
    "pared",
    "feliz",
    "triste",
    "grande",
    "peque침o",
    "alto",
    "bajo",
    "rapido",
    "lento",
    "fuerte",
    "suave",
  ];

  let currentType = "password";

  // Eventos para cambiar tipo
  typePasswordBtn.addEventListener("click", () => {
    currentType = "password";
    typePasswordBtn.classList.add("active");
    typePassphraseBtn.classList.remove("active");
    characterOptions.style.display = "block";
    passphraseOptions.style.display = "none";
    const password = generatePassword();
    if (password) {
      passwordOutput.value = password;
      updateStrengthMeter(password);
    }
  });

  typePassphraseBtn.addEventListener("click", () => {
    currentType = "passphrase";
    typePassphraseBtn.classList.add("active");
    typePasswordBtn.classList.remove("active");
    characterOptions.style.display = "none";
    passphraseOptions.style.display = "block";
    const passphrase = generatePassphrase();
    if (passphrase) {
      passwordOutput.value = passphrase;
      updateStrengthMeter(passphrase);
    }
  });

  lengthSlider.addEventListener("input", () => {
    lengthValue.textContent = lengthSlider.value;
    // Regenerar contrase침a autom치ticamente cuando cambie la longitud
    if (currentType === "password") {
      const password = generatePassword();
      if (password) {
        passwordOutput.value = password;
        updateStrengthMeter(password);
      }
    } else {
      const passphrase = generatePassphrase();
      if (passphrase) {
        passwordOutput.value = passphrase;
        updateStrengthMeter(passphrase);
      }
    }
  });

  function generatePassphrase(): string {
    const wordCount = Math.max(
      3,
      Math.min(8, parseInt(lengthSlider.value) / 4),
    ); // Aproximadamente
    const separator = wordSeparator.value;
    const includeNums = includeNumbersPhrase.checked;
    const capitalize = capitalizeWords.checked;

    let words = [];
    for (let i = 0; i < wordCount; i++) {
      let word = spanishWords[Math.floor(Math.random() * spanishWords.length)];

      if (capitalize) {
        word = word.charAt(0).toUpperCase() + word.slice(1);
      }

      if (includeNums && Math.random() > 0.6) {
        word += Math.floor(Math.random() * 100);
      }

      words.push(word);
    }

    return words.join(separator);
  }

  function generatePassword(): string {
    const length = parseInt(lengthSlider.value);
    let chars = "";
    let password = "";

    if (uppercaseCheck.checked) chars += uppercase;
    if (lowercaseCheck.checked) chars += lowercase;
    if (numbersCheck.checked) chars += numbers;
    if (symbolsCheck.checked) chars += symbols;

    if (chars === "") {
      alert("Selecciona al menos una opci칩n");
      return "";
    }

    for (let i = 0; i < length; i++) {
      const randomIndex = Math.floor(Math.random() * chars.length);
      password += chars[randomIndex];
    }

    return password;
  }

  function calculateStrength(password: string): number {
    let strength = 0;

    if (password.length >= 12) strength += 25;
    else if (password.length >= 8) strength += 15;

    if (/[a-z]/.test(password)) strength += 20;
    if (/[A-Z]/.test(password)) strength += 20;
    if (/[0-9]/.test(password)) strength += 20;
    if (/[^a-zA-Z0-9]/.test(password)) strength += 15;

    return Math.min(strength, 100);
  }

  function updateStrengthMeter(password: string) {
    const strength = calculateStrength(password);
    strengthFill.style.width = `${strength}%`;

    if (strength < 40) {
      strengthFill.style.background = "#ef4444";
      strengthText.textContent = "Muy d칠bil";
      strengthText.style.color = "#ef4444";
    } else if (strength < 70) {
      strengthFill.style.background = "#f59e0b";
      strengthText.textContent = "Media";
      strengthText.style.color = "#f59e0b";
    } else {
      strengthFill.style.background = "#10b981";
      strengthText.textContent = "Fuerte";
      strengthText.style.color = "#10b981";
    }
  }

  generateBtn.addEventListener("click", () => {
    if (currentType === "password") {
      const password = generatePassword();
      if (password) {
        passwordOutput.value = password;
        updateStrengthMeter(password);
      }
    } else {
      const passphrase = generatePassphrase();
      if (passphrase) {
        passwordOutput.value = passphrase;
        updateStrengthMeter(passphrase);
      }
    }
  });

  copyBtn.addEventListener("click", async () => {
    if (passwordOutput.value && passwordOutput.value.trim() !== "") {
      try {
        await navigator.clipboard.writeText(passwordOutput.value);
        notification.classList.add("show");
        setTimeout(() => {
          notification.classList.remove("show");
        }, 2000);
      } catch (err) {
        console.error("Error al copiar:", err);
        // Fallback para navegadores m치s antiguos
        passwordOutput.select();
        document.execCommand("copy");
        notification.classList.add("show");
        setTimeout(() => {
          notification.classList.remove("show");
        }, 2000);
      }
    }
  });

  // Agregar eventos para regenerar autom치ticamente cuando cambien las opciones
  [uppercaseCheck, lowercaseCheck, numbersCheck, symbolsCheck].forEach(
    (checkbox) => {
      checkbox.addEventListener("change", () => {
        if (currentType === "password") {
          const password = generatePassword();
          if (password) {
            passwordOutput.value = password;
            updateStrengthMeter(password);
          }
        }
      });
    },
  );

  // Eventos para opciones de frases
  [includeNumbersPhrase, capitalizeWords].forEach((checkbox) => {
    checkbox.addEventListener("change", () => {
      if (currentType === "passphrase") {
        const passphrase = generatePassphrase();
        if (passphrase) {
          passwordOutput.value = passphrase;
          updateStrengthMeter(passphrase);
        }
      }
    });
  });

  wordSeparator.addEventListener("change", () => {
    if (currentType === "passphrase") {
      const passphrase = generatePassphrase();
      if (passphrase) {
        passwordOutput.value = passphrase;
        updateStrengthMeter(passphrase);
      }
    }
  });

  // Generar contrase침a inicial
  window.addEventListener("DOMContentLoaded", () => {
    const password = generatePassword();
    if (password) {
      passwordOutput.value = password;
      updateStrengthMeter(password);
    }
  });
</script>
